<div class="entity-menu-dialog">
  <div class="name">
    <ng-container *ngIf="data.entity && gameManager.isCharacter(data.figure) && gameManager.isCharacter(data.entity)">
      <span class="spacer"></span>
      <img (click)="toggleCharacterMarker()" class="icon character-icon"
        [src]="gameManager.toCharacter(data.figure).iconUrl" />
      <span class="character-title"
        [ngClass]="{'absent' : gameManager.toCharacter(data.figure).absent}">{{gameManager.characterManager.characterName(gameManager.toCharacter(data.figure),true)}}</span>
      <span class="spacer"></span>
      <img class="absent"
        [src]="'./assets/images/status/' + (gameManager.toCharacter(data.figure).absent ? 'absent': 'present') + '.svg'"
        [ghs-label]="(gameManager.toCharacter(data.figure).absent ? 'character.present' : 'character.absent')"
        [ghs-label-attribute]="'title'" (click)="toggleCharacterAbsent()">
    </ng-container>
    <ng-container *ngIf="data.entity && gameManager.isObjective(data.entity)">
      <img class="icon"
        [src]="'./assets/images/objective/' + (gameManager.toObjective(data.entity).escort ? 'escort' : 'objective') + '.svg'" />
      <span *ngIf="gameManager.toObjective(data.entity).title">{{ gameManager.toObjective(data.entity).title}}</span>
      <span *ngIf="!gameManager.toObjective(data.entity).title && gameManager.toObjective(data.entity).name"
        [ghs-label]="'data.objective.' + gameManager.toObjective(data.entity).name"></span>
      <span *ngIf="!gameManager.toObjective(data.entity).title && !gameManager.toObjective(data.entity).name"
        [ghs-label]="gameManager.toObjective(data.entity).escort ? 'escort' : 'objective'"></span>
      <span *ngIf="gameManager.toObjective(data.entity).title">
        &nbsp;(
        <span [ghs-label]="gameManager.toObjective(data.entity).escort ? 'escort' : 'objective'"></span>
        )
      </span>
    </ng-container>
    <ng-container *ngIf="gameManager.isObjectiveContainer(data.figure)">
      <img class="icon"
        [src]="'./assets/images/objective/' + (gameManager.toObjectiveContainer(data.figure).escort ? 'escort' : 'objective') + '.svg'" />
      <span
        *ngIf="gameManager.toObjectiveContainer(data.figure).title">{{ gameManager.toObjectiveContainer(data.figure).title}}</span>
      <span
        *ngIf="!gameManager.toObjectiveContainer(data.figure).title && gameManager.toObjectiveContainer(data.figure).name"
        [ghs-label]="'data.objective.' + gameManager.toObjectiveContainer(data.figure).name"></span>
      <span
        *ngIf="!gameManager.toObjectiveContainer(data.figure).title && !gameManager.toObjectiveContainer(data.figure).name"
        [ghs-label]="gameManager.toObjectiveContainer(data.figure).escort ? 'escort' : 'objective'"></span>
      <span *ngIf="gameManager.toObjectiveContainer(data.figure).title">
        &nbsp;(
        <span [ghs-label]="gameManager.toObjectiveContainer(data.figure).escort ? 'escort' : 'objective'"></span>
        )
      </span>
    </ng-container>
    <div class="name" *ngIf="gameManager.isMonster(data.figure)" (click)="changeMonsterEntity()"
      [ngClass]="{'change-entity': gameManager.monsterManager.monsterStandeeMax(gameManager.toMonster(data.figure)) > 1 || data.entity && gameManager.isMonsterEntity(data.entity) && gameManager.toMonsterEntity(data.entity).type != MonsterType.boss}">
      <img *ngIf="!gameManager.toMonster(data.figure).noThumbnail && !settingsManager.settings.disableArtwork"
        class="standee" [src]="gameManager.monsterManager.monsterThumbnail(gameManager.toMonster(data.figure))" />
      <span [ghs-label]="'data.monster.' + data.figure.name"></span>&nbsp;
      <span class="ally" *ngIf="gameManager.toMonster(data.figure).isAlly"><span
          [ghs-label]="'game.ally'"></span>&nbsp;</span>
      <span class="allied" *ngIf="gameManager.toMonster(data.figure).isAllied"><span
          [ghs-label]="'game.allied'"></span>&nbsp;</span>
      <span class="standee-number" *ngIf="data.entity && gameManager.isMonsterEntity(data.entity)"
        [ngClass]="gameManager.toMonsterEntity(data.entity).type">#{{gameManager.toMonsterEntity(data.entity).number}}</span>
    </div>

    <ng-container *ngIf="data.entity && gameManager.isCharacter(data.figure) && gameManager.isSummon(data.entity)">
      <small>
        <img class="icon" [src]="gameManager.toCharacter(data.figure).iconUrl" />
        <span *ngIf="gameManager.toCharacter(data.figure).title">{{gameManager.toCharacter(data.figure).title}}</span>
        <span *ngIf="gameManager.toCharacter(data.figure).title">&nbsp;(<span
            [ghs-label]="'data.character.' + data.figure.name"></span>)</span>
        <span *ngIf="!gameManager.toCharacter(data.figure).title"
          [ghs-label]="'data.character.' + data.figure.name"></span>
      </small>

      <span *ngIf="gameManager.toSummon(data.entity).title">{{gameManager.toSummon(data.entity).title}}&nbsp;</span>
      <span *ngIf="gameManager.toSummon(data.entity).name"><span
          *ngIf="gameManager.toSummon(data.entity).title">(</span>
        <span [ghs-label]="'data.summon.' + gameManager.toSummon(data.entity).name"></span>
        <span *ngIf="gameManager.toSummon(data.entity).title">)</span></span>
      <span *ngIf="!gameManager.toSummon(data.entity).name"><span [ghs-label]="'game.summon'"></span></span>
      <span class="summon-icon">
        <img src="./assets/images/summons/{{gameManager.toSummon(data.entity).color}}.png">
        <span class="summon-number">{{gameManager.toSummon(data.entity).number}}</span>
      </span>
    </ng-container>
  </div>

  <div *ngIf="!levelDialog && (!gameManager.isCharacter(data.figure) || !gameManager.toCharacter(data.figure).absent)"
    class="status-container">
    <div class="entity-container">

      <div class="action-hint" *ngFor="let actionHint of actionHints">
        <ghs-action [action]="actionHint" [highlight]="settingsManager.settings.statAnimations"></ghs-action>
      </div>

      <ng-container
        *ngIf="data.entity && EntityValueFunction(data.entity.maxHealth) > 0 && (!gameManager.isMonster(data.figure) || !gameManager.toMonster(data.figure).immortal)">
        <span class="item">
          <ghs-pointer-input class="button" [ngClass]="{'disabled' : data.entity.health + health == 0}"
           (singleClick)="changeHealth(-1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/minus.svg">
          </ghs-pointer-input>
        </span>
        <span class="item" [ghs-label]="'game.health'" [ghs-label-attribute]="'title'">
          <span class="badge badge-left">{{data.entity.health + health}}</span>
          <img src="./assets/images/status/health.svg" />
          <span class="badge badge-right health-count"
            [ngClass]="{'negative-value' : health < 0, 'zero-value' : health == 0, 'positive-value' : health > 0}">{{health | ghsValueSign}}</span>
        </span>
        <span class="item">
          <ghs-pointer-input class="button"
            [ngClass]="{'disabled' : data.entity.health + health == EntityValueFunction(data.entity.maxHealth)}"
            (singleClick)="changeHealth(1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/plus.svg">
          </ghs-pointer-input>
        </span>

        <ng-container *ngIf="gameManager.isCharacter(data.entity)">
          <span class="item">
            <ghs-pointer-input class="button"
              [ngClass]="{'disabled' : gameManager.toCharacter(data.entity).experience + experience == 0}"
              (singleClick)="changeExperience(-1)" [repeat]="true">
              <img class="ghs-svg" src="./assets/images/minus.svg">
            </ghs-pointer-input>
          </span>
          <span class="item" [ghs-label]="'game.experience'" [ghs-label-attribute]="'title'">
            <span class="badge badge-left">{{gameManager.toCharacter(data.entity).experience + experience}}</span>
            <img src="./assets/images/status/experience.svg" />
            <span class="badge badge-right"
              [ngClass]="{'negative-value' : experience < 0, 'zero-value' : experience == 0, 'positive-value' : experience > 0}">{{experience | ghsValueSign}}</span>
          </span>
          <span class="item">
            <ghs-pointer-input class="button" (singleClick)="changeExperience(1)" [repeat]="true">
              <img class="ghs-svg" src="./assets/images/plus.svg">
            </ghs-pointer-input>
          </span>

          <ng-container *ngIf="!settingsManager.settings.alwaysLootDeck && !gameManager.fhRules()">
            <span class="item">
              <ghs-pointer-input class="button"
                [ngClass]="{'disabled' : gameManager.toCharacter(data.entity).loot + loot == 0}"
                (singleClick)="changeLoot(-1)" [repeat]="true">
                <img class="ghs-svg" src="./assets/images/minus.svg">
              </ghs-pointer-input>
            </span>
            <span class="item" [ghs-label]="'game.loot'" [ghs-label-attribute]="'title'">
              <span class="badge badge-left">{{gameManager.toCharacter(data.entity).loot + loot}}</span>
              <img src="./assets/images/status/loot.svg" />
              <span class="badge badge-right"
                [ngClass]="{'negative-value' : loot < 0, 'zero-value' : loot == 0, 'positive-value' : loot > 0}">{{loot | ghsValueSign}}</span>
            </span>
            <span class="item">
              <ghs-pointer-input class="button" (singleClick)="changeLoot(1)" [repeat]="true">
                <img class="ghs-svg" src="./assets/images/plus.svg">
              </ghs-pointer-input>
            </span>
          </ng-container>

          <span class="item">
            <ghs-pointer-input class="button"
              [ngClass]="{'disabled' : gameManager.toCharacter(data.entity).token + characterToken == 0}"
              (singleClick)="changeCharacterToken(-1)" [repeat]="true">
              <img class="ghs-svg" src="./assets/images/minus.svg">
            </ghs-pointer-input>
          </span>
          <span class="item character-token" [ghs-label]="'game.character.token'" [ghs-label-attribute]="'title'">
            <span class="badge badge-left">{{gameManager.toCharacter(data.entity).token + characterToken}}</span>
            <span [ghs-label]="'%data.characterToken.' + gameManager.toCharacter(data.entity).name + '%'"></span>
            <span class="badge badge-right"
              [ngClass]="{'negative-value' : characterToken < 0, 'zero-value' : characterToken == 0, 'positive-value' : characterToken > 0}">{{characterToken | ghsValueSign}}</span>
          </span>
          <span class="item">
            <ghs-pointer-input class="button" (singleClick)="changeCharacterToken(1)" [repeat]="true">
              <img class="ghs-svg" src="./assets/images/plus.svg">
            </ghs-pointer-input>
          </span>

          <ng-container *ngFor="let token of gameManager.toCharacter(data.entity).tokens; let i = index;">
            <span class="item">
              <ghs-pointer-input class="button"
                [ngClass]="{'disabled' : gameManager.toCharacter(data.entity).tokenValues[i] + characterTokenValues[i] == 0}"
                (singleClick)="changeCharacterToken(-1, i)" [repeat]="true">
                <img class="ghs-svg" src="./assets/images/minus.svg">
              </ghs-pointer-input>
            </span>
            <span class="item character-token" [ghs-label]="'data.character.token.' + token"
              [ghs-label-attribute]="'title'">
              <span class="badge badge-left">{{gameManager.toCharacter(data.entity).tokenValues[i] + characterTokenValues[i]}}</span>
              <span
                [ghs-label]="'%data.characterToken.' + gameManager.toCharacter(data.entity).name + '.' + token + '%'"></span>
              <span class="badge badge-right"
                [ngClass]="{'negative-value' : characterTokenValues[i] < 0, 'zero-value' : characterTokenValues[i] == 0, 'positive-value' : characterTokenValues[i] > 0}">{{characterTokenValues[i] | ghsValueSign}}</span>
            </span>
            <span class="item">
              <ghs-pointer-input class="button" (singleClick)="changeCharacterToken(1, i)" [repeat]="true">
                <img class="ghs-svg" src="./assets/images/plus.svg">
              </ghs-pointer-input>
            </span>
          </ng-container>
        </ng-container>
      </ng-container>

      <ng-container
        *ngIf="(gameManager.isCharacter(data.figure) && settingsManager.settings.characterAttackModifierDeck || gameManager.isMonster(data.figure)) && (!data.entity || EntityValueFunction(data.entity.maxHealth) > 0 && (!gameManager.isMonster(data.figure) || !gameManager.toMonster(data.figure).immortal))">

        <span class="item">
          <ghs-pointer-input class="button"
            [ngClass]="{'disabled' : countUpcomingAttackModifier(AttackModifierType.bless) + bless == 0 || isImmune(ConditionName.bless)}"
            (singleClick)="changeBless(-1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/minus.svg">
          </ghs-pointer-input>
        </span>
        <span class="item">
          <span class="badge badge-left bless-count">{{countUpcomingAttackModifier(AttackModifierType.bless) + bless}}</span>
          <span class="condition" [ghsTooltip]="'game.condition.bless.hint'" [originX]="'center'" [overlayX]="'center'"
            [originY]="'top'" [overlayY]="'bottom'" [ngClass]="{'immunity disabled' : isImmune(ConditionName.bless)}">
            <img src="./assets/images/status/bless.svg" />
          </span>
          <span class="badge badge-right"
            [ngClass]="{'negative-value' : bless < 0, 'zero-value' : bless == 0, 'positive-value' : bless > 0}">{{bless | ghsValueSign}}</span>
          <span class="warning-badge" *ngIf="gameManager.attackModifierManager.countUpcomingBlesses() + bless > 10">
            <img src="./assets/images/warning.svg" />
          </span>
        </span>
        <span class="item">
          <ghs-pointer-input class="button"
            [ngClass]="{'disabled' : gameManager.attackModifierManager.countUpcomingBlesses() + bless >= 10 || isImmune(ConditionName.bless)}"
            (singleClick)="changeBless(1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/plus.svg">
          </ghs-pointer-input>
        </span>

        <span class="item">
          <ghs-pointer-input class="button"
            [ngClass]="{'disabled' : countUpcomingAttackModifier(AttackModifierType.curse) + curse == 0 || isImmune(ConditionName.curse)}"
            (singleClick)="changeCurse(-1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/minus.svg">
          </ghs-pointer-input>
        </span>
        <span class="item">
          <span class="badge badge-left curse-count">{{countUpcomingAttackModifier(AttackModifierType.curse) + curse}}</span>
          <span class="condition" [ghsTooltip]="'game.condition.curse.hint'" [originX]="'center'" [overlayX]="'center'"
            [originY]="'top'" [overlayY]="'bottom'" [ngClass]="{'immunity disabled' : isImmune(ConditionName.curse)}">
            <img src="./assets/images/status/curse.svg" />
          </span>
          <span class="badge badge-right"
            [ngClass]="{'negative-value' : curse < 0, 'zero-value' : curse == 0, 'positive-value' : curse > 0}">{{curse | ghsValueSign}}</span>
          <span class="warning-badge"
            *ngIf="gameManager.attackModifierManager.countUpcomingCurses(gameManager.isMonster(data.figure) && !gameManager.toMonster(data.figure).isAlly && !gameManager.toMonster(data.figure).isAllied) + curse > 10">
            <img src="./assets/images/warning.svg" />
          </span>
        </span>
        <span class="item">
          <ghs-pointer-input class="button"
            [ngClass]="{'disabled' : gameManager.attackModifierManager.countUpcomingCurses(gameManager.isMonster(data.figure) && !gameManager.toMonster(data.figure).isAlly && !gameManager.toMonster(data.figure).isAllied) + curse >= 10 || isImmune(ConditionName.curse)}"
            (singleClick)="changeCurse(1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/plus.svg">
          </ghs-pointer-input>
        </span>

        <ng-container *ngIf="gameManager.isCharacter(data.figure) && countAdditional(AttackModifierType.empower)">
          <span class="item">
            <ghs-pointer-input class="button"
              [ngClass]="{'disabled' : countUpcomingAttackModifier(AttackModifierType.empower) + empower == 0}"
              (singleClick)="changeEmpower(-1)" [repeat]="true">
              <img class="ghs-svg" src="./assets/images/minus.svg">
            </ghs-pointer-input>
          </span>
          <span class="item" [ghsTooltip]="'game.condition.empower.hint'" [originX]="'center'" [overlayX]="'center'"
            [originY]="'top'" [overlayY]="'bottom'">
            <span class="badge badge-left empower-count">{{countUpcomingAttackModifier(AttackModifierType.empower) + empower}}</span>
            <span class="condition">
              <img src="./assets/images/status/empower.svg" />
            </span>
            <span class="badge badge-right"
              [ngClass]="{'negative-value' : empower < 0, 'zero-value' : empower == 0, 'positive-value' : empower > 0}">{{empower | ghsValueSign}}</span>
            <span class="warning-badge"
              *ngIf="countUpcomingAttackModifier(AttackModifierType.empower) + empower > countAdditional(AttackModifierType.empower)">
              <img src="./assets/images/warning.svg" />
            </span>
          </span>
          <span class="item">
            <ghs-pointer-input class="button"
              [ngClass]="{'disabled' : countUpcomingAttackModifier(AttackModifierType.empower) + empower >= countAdditional(AttackModifierType.empower)}"
              (singleClick)="changeEmpower(1)" [repeat]="true">
              <img class="ghs-svg" src="./assets/images/plus.svg">
            </ghs-pointer-input>
          </span>
        </ng-container>

        <ng-container *ngIf="gameManager.isCharacter(data.figure) && countAdditional(AttackModifierType.enfeeble)">
          <span class="item">
            <ghs-pointer-input class="button"
              [ngClass]="{'disabled' : countUpcomingAttackModifier(AttackModifierType.enfeeble) + enfeeble == 0}"
              (singleClick)="changeEnfeeble(-1)" [repeat]="true">
              <img class="ghs-svg" src="./assets/images/minus.svg">
            </ghs-pointer-input>
          </span>
          <span class="item" [ghsTooltip]="'game.condition.enfeeble.hint'" [originX]="'center'" [overlayX]="'center'"
            [originY]="'top'" [overlayY]="'bottom'">
            <span class="badge badge-left enfeeble-count">{{countUpcomingAttackModifier(AttackModifierType.enfeeble) + enfeeble}}</span>
            <span class="condition">
              <img src="./assets/images/status/enfeeble.svg" />
            </span>
            <span class="badge badge-right"
              [ngClass]="{'negative-value' : enfeeble < 0, 'zero-value' : enfeeble == 0, 'positive-value' : enfeeble > 0}">{{enfeeble | ghsValueSign}}</span>
            <span class="warning-badge"
              *ngIf="countUpcomingAttackModifier(AttackModifierType.enfeeble) + enfeeble > countAdditional(AttackModifierType.enfeeble)">
              <img src="./assets/images/warning.svg" />
            </span>
          </span>
          <span class="item">
            <ghs-pointer-input class="button"
              [ngClass]="{'disabled' : countUpcomingAttackModifier(AttackModifierType.enfeeble) + enfeeble >= countAdditional(AttackModifierType.enfeeble)}"
              (singleClick)="changeEnfeeble(1)" [repeat]="true">
              <img class="ghs-svg" src="./assets/images/plus.svg">
            </ghs-pointer-input>
          </span>
        </ng-container>

      </ng-container>

      <ng-container *ngIf="data.entity && gameManager.isObjective(data.entity)">
        <span class="item">
          <ghs-pointer-input class="button" (singleClick)="changeId(-1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/left.svg">
          </ghs-pointer-input>
        </span>
        <span class="item">
          <span class="objective-marker">{{((gameManager.toObjective(data.entity).id + id) % 12) + 1}}</span>
        </span>
        <span class="item">
          <ghs-pointer-input class="button" (singleClick)="changeId(1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/right.svg">
          </ghs-pointer-input>
        </span>

        <span class="item">
          <ghs-pointer-input class="button" (singleClick)="changeMarker(-1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/left.svg">
          </ghs-pointer-input>
        </span>
        <span class="item">
          <span class="map-marker"
            [ngClass]="{'empty' : !OBJECTIV_MARKERS[(marker +
          OBJECTIV_MARKERS.indexOf(gameManager.toObjective(data.entity).marker)) % OBJECTIV_MARKERS.length]}">{{OBJECTIV_MARKERS[(marker +
            OBJECTIV_MARKERS.indexOf(gameManager.toObjective(data.entity).marker)) % OBJECTIV_MARKERS.length]}}</span>
        </span>
        <span class="item">
          <ghs-pointer-input class="button" (singleClick)="changeMarker(1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/right.svg">
          </ghs-pointer-input>
        </span>
      </ng-container>


      <ng-container *ngIf="data.entity && gameManager.isObjectiveEntity(data.entity)">
        <span class="item">
          <ghs-pointer-input class="button" (singleClick)="changeId(-1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/left.svg">
          </ghs-pointer-input>
        </span>
        <span class="item">
          <span class="objective-marker">{{(gameManager.toObjectiveEntity(data.entity).number + id)}}</span>
        </span>
        <span class="item">
          <ghs-pointer-input class="button" (singleClick)="changeId(1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/right.svg">
          </ghs-pointer-input>
        </span>

        <span class="item">
          <ghs-pointer-input class="button" (singleClick)="changeMarker(-1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/left.svg">
          </ghs-pointer-input>
        </span>
        <span class="item">
          <span class="map-marker"
            [ngClass]="{'empty' : !OBJECTIV_MARKERS[(marker +
          OBJECTIV_MARKERS.indexOf(gameManager.toObjectiveEntity(data.entity).marker)) % OBJECTIV_MARKERS.length]}">{{OBJECTIV_MARKERS[(marker +
            OBJECTIV_MARKERS.indexOf(gameManager.toObjectiveEntity(data.entity).marker)) % OBJECTIV_MARKERS.length]}}</span>
        </span>
        <span class="item">
          <ghs-pointer-input class="button" (singleClick)="changeMarker(1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/right.svg">
          </ghs-pointer-input>
        </span>
      </ng-container>

      <ng-container *ngIf="data.entity && gameManager.isSummon(data.entity)">
        <div class="summon-stats-container">
          <span class="stat" (click)="openLevelDialog()">
            <img class="ghs-svg" src="./assets/images/action/move.svg" />
            <span [value-calc]="gameManager.toSummon(data.entity).movement" [empty]="true">></span>
          </span>

          <span class="stat" (click)="openLevelDialog()">
            <img class="ghs-svg" src="./assets/images/action/attack.svg" />
            <span *ngIf="gameManager.toSummon(data.entity).attack != 0"
              [ghs-label]="'' + gameManager.toSummon(data.entity).attack"></span>
            <span *ngIf="gameManager.toSummon(data.entity).attack == 0">-</span>
          </span>

          <span class="stat" (click)="openLevelDialog()">
            <img class="ghs-svg" src="./assets/images/action/range.svg" />
            <span [value-calc]="gameManager.toSummon(data.entity).range" [empty]="true">></span>
          </span>

          <span class="action" *ngIf="gameManager.toSummon(data.entity).action">
            <ghs-action [action]="gameManager.toSummon(data.entity).action"></ghs-action>
          </span>

          <span class="action" *ngIf="gameManager.toSummon(data.entity).additionalAction">
            <ghs-action [action]="gameManager.toSummon(data.entity).additionalAction"></ghs-action>
          </span>
        </div>
      </ng-container>

      <div class="marker-container">
        <a class="summon"
          *ngIf="data.entity && EntityValueFunction(data.entity.maxHealth) > 0 && (!gameManager.isMonster(data.figure) || !gameManager.toMonster(data.figure).immortal) && gameManager.isMonsterEntity(data.entity)"
          [ngClass]="{'active' : gameManager.toMonsterEntity(data.entity).summon == SummonState.true, 'new' : gameManager.toMonsterEntity(data.entity).summon == SummonState.new }"
          (click)="toggleSummon()">
          <img src="./assets/images/summons/{{gameManager.toMonster(data.figure).summonColor}}.png">
        </a>
        <span *ngFor="let marker of markers()">
          <a class="item" [ngClass]="{'active' : hasMarker(marker)}" (click)="toggleMarker(marker)">
            <span class="condition marker">
              <img src="./assets/images/character/icons/{{marker}}.svg" />
            </span>
          </a>
        </span>
      </div>

      <ng-container *ngIf="data.entity && gameManager.isCharacter(data.entity)">
        <span class="item" [ghs-label]="'game.exhausted'" [ghs-label-attribute]="'title'"
          [ngClass]="{'active' : gameManager.toCharacter(data.entity).exhausted}">
          <a class="exhausted" (click)="toggleExhausted()">
            <img class="ghs-svg" src="./assets/images/status/exhausted.svg" />
          </a>
        </span>
      </ng-container>


      <ng-container *ngIf="data.entity && gameManager.isObjective(data.entity)">
        <span class="item" [ghs-label]="'game.dead'" [ghs-label-attribute]="'title'">
          <a class="button" (click)="toggleDead()">
            <img src="./assets/images/status/dead.svg" />
          </a>
        </span>
        <span class="item" [ghs-label]="'game.exhausted'" [ghs-label-attribute]="'title'"
          [ngClass]="{'active' : gameManager.toObjective(data.entity).exhausted || false}">
          <a class="exhausted" (click)="toggleExhausted()">
            <img class="ghs-svg" src="./assets/images/status/exhausted.svg" />
          </a>
        </span>
      </ng-container>


      <ng-container *ngIf="data.entity && gameManager.isObjectiveEntity(data.entity)">
        <span class="item" [ghs-label]="'game.dead'" [ghs-label-attribute]="'title'">
          <a class="button" (click)="toggleDead()">
            <img src="./assets/images/status/dead.svg" />
          </a>
        </span>
      </ng-container>

      <ng-container *ngIf="data.entity && gameManager.isCharacter(data.entity)">
        <span class="item" [ghs-label]="'game.level'" [ghs-label-attribute]="'title'">
          <a class="button level-button" (click)="openLevelDialog()">
            {{data.figure.level}} <img src="./assets/images/status/level.svg" />
          </a>
        </span>
      </ng-container>

      <ng-container *ngIf="data.entity && gameManager.isSummon(data.entity)">
        <span class="item" [ghs-label]="'game.dead'" [ghs-label-attribute]="'title'">
          <a class="button" (click)="toggleDead()">
            <img src="./assets/images/status/dead.svg" />
          </a>
        </span>

        <span class="item" [ghs-label]="'game.level'" [ghs-label-attribute]="'title'">
          <a class="button level-button" (click)="openLevelDialog()">
            {{data.figure.level}} <img src="./assets/images/status/level.svg" />
          </a>
        </span>

        <span class="item">
          <a class="summon"
            [ngClass]="{'active' : gameManager.toSummon(data.entity).state == SummonState.true, 'new' : gameManager.toSummon(data.entity).state == SummonState.new }"
            (click)="toggleSummonStatus()">
            <img src="./assets/images/summons/{{gameManager.toSummon(data.entity).color}}.png">
          </a>
        </span>
      </ng-container>

      <ng-container *ngIf="data.entity && gameManager.isMonsterEntity(data.entity)">
        <span class="item" [ghs-label]="'game.dead'" [ghs-label-attribute]="'title'">
          <a class="button" (click)="toggleDead()">
            <img src="./assets/images/status/dead.svg" />
          </a>
        </span>
        <span class="item max-health-container" *ngIf="EntityValueFunction(data.entity.maxHealth) > 0">
          <ghs-pointer-input class="button" (singleClick)="changeMaxHealth(-1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/minus.svg">
          </ghs-pointer-input>
          <img src="./assets/images/status/health.svg" [ghs-label]="'game.maxHealth'" [ghs-label-attribute]="'title'" />
          <span class="badge badge-right max-health">{{(EntityValueFunction(data.entity.maxHealth) + maxHp <
              EntityValueFunction(data.entity.maxHealth) || data.entity.health==(+data.entity.maxHealth) ?
              EntityValueFunction(data.entity.maxHealth) + maxHp :
              data.entity.health)}}/{{EntityValueFunction(data.entity.maxHealth) + maxHp}}</span>
          <ghs-pointer-input class="button" (singleClick)="changeMaxHealth(1)" [repeat]="true">
            <img class="ghs-svg" src="./assets/images/plus.svg">
          </ghs-pointer-input>
        </span>
      </ng-container>
    </div>

    <ng-container
      *ngIf="data.entity && EntityValueFunction(data.entity.maxHealth) > 0 && (!gameManager.isObjective(data.entity) || gameManager.toObjective(data.entity).escort) && (!gameManager.isObjectiveEntity(data.entity) || gameManager.isObjectiveContainer(data.figure) && gameManager.toObjectiveContainer(data.figure).escort) && (!gameManager.isMonster(data.figure) || !gameManager.toMonster(data.figure).immortal)">
      <ghs-conditions [entityConditions]="entityConditions" [immunities]="entityImmunities" [entity]="data.entity"
        [figure]="data.figure" [type]="conditionType"></ghs-conditions>
    </ng-container>
  </div>

  <ng-container *ngIf="data.entity && gameManager.isObjective(data.entity)">
    <div class="objective-container">
      <input class="title" #objectiveTitle [value]="gameManager.toObjective(data.entity).title || ''" />
      <ng-container *ngIf="showMaxHealth()">
        <a class="button" (click)="changeMaxHealth(-1)">
          <img class="ghs-svg" src="./assets/images/minus.svg">
        </a>
        <span class="item">
          <img src="./assets/images/status/health.svg" />
          <span class="badge badge-right max-health">{{(EntityValueFunction(data.entity.maxHealth) + maxHp <
              EntityValueFunction(data.entity.maxHealth) ||
              data.entity.health==EntityValueFunction(data.entity.maxHealth) ?
              EntityValueFunction(data.entity.maxHealth) + maxHp :
              data.entity.health)}}/{{EntityValueFunction(data.entity.maxHealth) + maxHp}}</span>
        </span>
        <a class="button" (click)="changeMaxHealth(1)">
          <img class="ghs-svg" src="./assets/images/plus.svg">
        </a>
      </ng-container>
    </div>
  </ng-container>

  <ng-container
    *ngIf="gameManager.isObjectiveContainer(data.figure) && data.entity && gameManager.isObjectiveEntity(data.entity)">
    <div class="objective-container">
      <input class="title" #objectiveTitle [value]="gameManager.toObjectiveContainer(data.figure).title || ''" />
      <ng-container *ngIf="showMaxHealth()">
        <a class="button" (click)="changeMaxHealth(-1)">
          <img class="ghs-svg" src="./assets/images/minus.svg">
        </a>
        <span class="item">
          <img src="./assets/images/status/health.svg" />
          <span class="badge badge-right max-health">{{(EntityValueFunction(gameManager.toObjectiveContainer(data.figure).health) + maxHp <
            EntityValueFunction(gameManager.toObjectiveContainer(data.figure).health) ||
            data.entity.health==EntityValueFunction(gameManager.toObjectiveContainer(data.figure).health) ?
            EntityValueFunction(gameManager.toObjectiveContainer(data.figure).health) + maxHp :
            data.entity.health)}}/{{EntityValueFunction(gameManager.toObjectiveContainer(data.figure).health) +
            maxHp}}</span>
        </span>
        <a class="button" (click)="changeMaxHealth(1)">
          <img class="ghs-svg" src="./assets/images/plus.svg">
        </a>
      </ng-container>
    </div>
  </ng-container>

  <div *ngIf="levelDialog" class="level-dialog">
    <ng-container *ngIf="data.entity && gameManager.isCharacter(data.entity)">
      <div class="level-container">
        <span class="item"><img src="./assets/images/status/level.svg" /></span>
        <span class="item" *ngFor="let level of [] | ghsRange:9"><a class="level"
            [ngClass]="{'active' : level + 1 == data.entity.level}" (click)="setLevel(level + 1)">{{level
            +1}}</a></span>
      </div>
      <div class="char-container">
        <ng-container *ngIf="titles.length == 0 || !settingsManager.settings.characterIdentities">
          <img [src]="gameManager.characterManager.characterIcon(gameManager.toCharacter(data.entity).name)">
          <input class="title" #charactertitle type="text" [value]="gameManager.toCharacter(data.entity).title">
        </ng-container>
        <div class="titles-container" *ngIf="titles.length > 0 && settingsManager.settings.characterIdentities">
          <div class="title-container"
            *ngFor="let i of [] | ghsRange:gameManager.toCharacter(data.entity).identities.length">
            <img
              [src]="gameManager.characterManager.characterIdentityIcon(gameManager.toCharacter(data.entity).name,gameManager.toCharacter(data.entity).identity)">
            <input class="title" type="text" [value]="titles[i]" (change)="setTitle($event, i)">
          </div>
        </div>

        <a class="button" (click)="changeMaxHealth(-1)">
          <img class="ghs-svg" src="./assets/images/minus.svg">
        </a>
        <span class="item" [ghs-label]="'game.maxHealth'" [ghs-label-attribute]="'title'">
          <img src="./assets/images/status/health.svg" />
          <span class="badge badge-right max-health">{{(EntityValueFunction(data.entity.maxHealth) + maxHp <
              EntityValueFunction(data.entity.maxHealth) ||
              data.entity.health==EntityValueFunction(data.entity.maxHealth) ?
              EntityValueFunction(data.entity.maxHealth) + maxHp :
              data.entity.health)}}/{{EntityValueFunction(data.entity.maxHealth) + maxHp}}</span>
        </span>
        <a class="button" (click)="changeMaxHealth(1)">
          <img class="ghs-svg" src="./assets/images/plus.svg">
        </a>
      </div>
    </ng-container>
    <ng-container *ngIf="data.entity && gameManager.isSummon(data.entity)">
      <input class="title" #summonTitle />
      <div class="summon-container">
        <a class="button" (click)="changeMaxHealth(-1)"
          [ngClass]="{'disabled' : EntityValueFunction(data.entity.maxHealth) + maxHp == 0}">
          <img class="ghs-svg" src="./assets/images/minus.svg">
        </a>
        <span class="item">
          <img src="./assets/images/status/health.svg" />
          <span class="badge badge-right max-health">{{(EntityValueFunction(data.entity.maxHealth) + maxHp <
              EntityValueFunction(data.entity.maxHealth) ||
              data.entity.health==EntityValueFunction(data.entity.maxHealth) ?
              EntityValueFunction(data.entity.maxHealth) + maxHp :
              data.entity.health)}}/{{EntityValueFunction(data.entity.maxHealth) + maxHp}}</span>
        </span>
        <a class="button" (click)="changeMaxHealth(1)">
          <img class="ghs-svg" src="./assets/images/plus.svg">
        </a>

        <a class="button" (click)="changeMovement(-1)"
          [ngClass]="{'disabled' : gameManager.toSummon(data.entity).movement + movement == 0}">
          <img class="ghs-svg" src="./assets/images/minus.svg">
        </a>
        <span class="item">
          <img class="ghs-svg" src="./assets/images/action/move.svg" />
          <span class="badge badge-right" [value-calc]="gameManager.toSummon(data.entity).movement + movement"
            [empty]="true">></span>
        </span>
        <a class="button" (click)="changeMovement(1)">
          <img class="ghs-svg" src="./assets/images/plus.svg">
        </a>

        <a class="button" (click)="changeAttack(-1)"
          [ngClass]="{'disabled' : gameManager.toSummon(data.entity).attack == 'X' || +gameManager.toSummon(data.entity).attack + attack == 0}">
          <img class="ghs-svg" src="./assets/images/minus.svg">
        </a>
        <span class="item">
          <img class="ghs-svg" src="./assets/images/action/attack.svg" />
          <span class="badge badge-right" *ngIf="gameManager.toSummon(data.entity).attack != 'X'"
            [value-calc]="+gameManager.toSummon(data.entity).attack + attack" [empty]="true"></span>
          <span class="badge badge-right" *ngIf="gameManager.toSummon(data.entity).attack == 'X'">X</span>
        </span>
        <a class="button" (click)="changeAttack(1)"
          [ngClass]="{'disabled' : gameManager.toSummon(data.entity).attack == 'X'}">
          <img class="ghs-svg" src="./assets/images/plus.svg">
        </a>

        <a class="button" (click)="changeRange(-1)"
          [ngClass]="{'disabled' : gameManager.toSummon(data.entity).range + range == 0}">
          <img class="ghs-svg" src="./assets/images/minus.svg">
        </a>
        <span class="item">
          <img class="ghs-svg" src="./assets/images/action/range.svg" />
          <span class="badge badge-right" [value-calc]="gameManager.toSummon(data.entity).range + range" [empty]="true">></span>
        </span>
        <a class="button" (click)="changeRange(1)">
          <img class="ghs-svg" src="./assets/images/plus.svg">
        </a>

      </div>
    </ng-container>
  </div>
</div>