"use strict";(self.webpackChunkgloomhavensecretariat=self.webpackChunkgloomhavensecretariat||[]).push([[635],{1016:(q,K,u)=>{u.r(K),u.d(K,{diagram:()=>Q});var _,w=u(766),A=(u(3571),u(9374),u(4583),u(1319),u(3926),u(5771),u(6273),u(6974),u(8389),u(5595)),t=u(4110),P=u(3172),N=u(8512),W=u(1823),k=(0,t.K2)(e=>e.append("circle").attr("class","start-state").attr("r",(0,t.D7)().state.sizeUnit).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit),"drawStartState"),U=(0,t.K2)(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",(0,t.D7)().state.textHeight).attr("class","divider").attr("x2",2*(0,t.D7)().state.textHeight).attr("y1",0).attr("y2",0),"drawDivider"),C=(0,t.K2)((e,i)=>{const d=e.append("text").attr("x",2*(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.textHeight+2*(0,t.D7)().state.padding).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.id),h=d.node().getBBox();return e.insert("rect",":first-child").attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding).attr("width",h.width+2*(0,t.D7)().state.padding).attr("height",h.height+2*(0,t.D7)().state.padding).attr("rx",(0,t.D7)().state.radius),d},"drawSimpleState"),H=(0,t.K2)((e,i)=>{const d=(0,t.K2)(function(c,E,B){const M=c.append("tspan").attr("x",2*(0,t.D7)().state.padding).text(E);B||M.attr("dy",(0,t.D7)().state.textHeight)},"addTspan"),r=e.append("text").attr("x",2*(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.textHeight+1.3*(0,t.D7)().state.padding).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.descriptions[0]).node().getBBox(),l=r.height,x=e.append("text").attr("x",(0,t.D7)().state.padding).attr("y",l+.4*(0,t.D7)().state.padding+(0,t.D7)().state.dividerMargin+(0,t.D7)().state.textHeight).attr("class","state-description");let a=!0,s=!0;i.descriptions.forEach(function(c){a||(d(x,c,s),s=!1),a=!1});const f=e.append("line").attr("x1",(0,t.D7)().state.padding).attr("y1",(0,t.D7)().state.padding+l+(0,t.D7)().state.dividerMargin/2).attr("y2",(0,t.D7)().state.padding+l+(0,t.D7)().state.dividerMargin/2).attr("class","descr-divider"),p=x.node().getBBox(),o=Math.max(p.width,r.width);return f.attr("x2",o+3*(0,t.D7)().state.padding),e.insert("rect",":first-child").attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding).attr("width",o+2*(0,t.D7)().state.padding).attr("height",p.height+l+2*(0,t.D7)().state.padding).attr("rx",(0,t.D7)().state.radius),e},"drawDescrState"),I=(0,t.K2)((e,i,d)=>{const h=(0,t.D7)().state.padding,r=2*(0,t.D7)().state.padding,l=e.node().getBBox(),x=l.width,a=l.x,s=e.append("text").attr("x",0).attr("y",(0,t.D7)().state.titleShift).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.id),p=s.node().getBBox().width+r;let c,o=Math.max(p,x);o===x&&(o+=r);const E=e.node().getBBox();c=a-h,p>x&&(c=(x-o)/2+h),Math.abs(a-E.x)<h&&p>x&&(c=a-(p-x)/2);const B=1-(0,t.D7)().state.textHeight;return e.insert("rect",":first-child").attr("x",c).attr("y",B).attr("class",d?"alt-composit":"composit").attr("width",o).attr("height",E.height+(0,t.D7)().state.textHeight+(0,t.D7)().state.titleShift+1).attr("rx","0"),s.attr("x",c+h),p<=x&&s.attr("x",a+(o-r)/2-p/2+h),e.insert("rect",":first-child").attr("x",c).attr("y",(0,t.D7)().state.titleShift-(0,t.D7)().state.textHeight-(0,t.D7)().state.padding).attr("width",o).attr("height",3*(0,t.D7)().state.textHeight).attr("rx",(0,t.D7)().state.radius),e.insert("rect",":first-child").attr("x",c).attr("y",(0,t.D7)().state.titleShift-(0,t.D7)().state.textHeight-(0,t.D7)().state.padding).attr("width",o).attr("height",E.height+3+2*(0,t.D7)().state.textHeight).attr("rx",(0,t.D7)().state.radius),e},"addTitleAndBox"),z=(0,t.K2)(e=>(e.append("circle").attr("class","end-state-outer").attr("r",(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",(0,t.D7)().state.sizeUnit).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+2).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+2)),"drawEndState"),j=(0,t.K2)((e,i)=>{let d=(0,t.D7)().state.forkWidth,h=(0,t.D7)().state.forkHeight;if(i.parentId){let r=d;d=h,h=r}return e.append("rect").style("stroke","black").style("fill","black").attr("width",d).attr("height",h).attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding)},"drawForkJoinState"),G=(0,t.K2)((e,i,d,h)=>{let r=0;const l=h.append("text");l.style("text-anchor","start"),l.attr("class","noteText");let x=e.replace(/\r\n/g,"<br/>");x=x.replace(/\n/g,"<br/>");const a=x.split(t.Y2.lineBreakRegex);let s=1.25*(0,t.D7)().state.noteMargin;for(const f of a){const p=f.trim();if(p.length>0){const o=l.append("tspan");o.text(p),0===s&&(s+=o.node().getBBox().height),r+=s,o.attr("x",i+(0,t.D7)().state.noteMargin),o.attr("y",d+r+1.25*(0,t.D7)().state.noteMargin)}}return{textWidth:l.node().getBBox().width,textHeight:r}},"_drawLongText"),F=(0,t.K2)((e,i)=>{i.attr("class","state-note");const d=i.append("rect").attr("x",0).attr("y",(0,t.D7)().state.padding),h=i.append("g"),{textWidth:r,textHeight:l}=G(e,0,0,h);return d.attr("height",l+2*(0,t.D7)().state.noteMargin),d.attr("width",r+2*(0,t.D7)().state.noteMargin),d},"drawNote"),L=(0,t.K2)(function(e,i){const d=i.id,h={id:d,label:i.id,width:0,height:0},r=e.append("g").attr("id",d).attr("class","stateGroup");"start"===i.type&&k(r),"end"===i.type&&z(r),("fork"===i.type||"join"===i.type)&&j(r,i),"note"===i.type&&F(i.note.text,r),"divider"===i.type&&U(r),"default"===i.type&&0===i.descriptions.length&&C(r,i),"default"===i.type&&i.descriptions.length>0&&H(r,i);const l=r.node().getBBox();return h.width=l.width+2*(0,t.D7)().state.padding,h.height=l.height+2*(0,t.D7)().state.padding,h},"drawState"),O=0,Y=(0,t.K2)(function(e,i,d){const h=(0,t.K2)(function(s){switch(s){case w.u4.relationType.AGGREGATION:return"aggregation";case w.u4.relationType.EXTENSION:return"extension";case w.u4.relationType.COMPOSITION:return"composition";case w.u4.relationType.DEPENDENCY:return"dependency"}},"getRelationType");i.points=i.points.filter(s=>!Number.isNaN(s.y));const r=i.points,l=(0,P.n8j)().x(function(s){return s.x}).y(function(s){return s.y}).curve(P.qrM),x=e.append("path").attr("d",l(r)).attr("id","edge"+O).attr("class","transition");let a="";if((0,t.D7)().state.arrowMarkerAbsolute&&(a=(0,t.ID)(!0)),x.attr("marker-end","url("+a+"#"+h(w.u4.relationType.DEPENDENCY)+"End)"),void 0!==d.title){const s=e.append("g").attr("class","stateLabel"),{x:f,y:p}=A._K.calcLabelPosition(i.points),o=t.Y2.getRows(d.title);let c=0;const E=[];let B=0,M=0;for(let n=0;n<=o.length;n++){const D=s.append("text").attr("text-anchor","middle").text(o[n]).attr("x",f).attr("y",p+c),g=D.node().getBBox();B=Math.max(B,g.width),M=Math.min(M,g.x),t.Rm.info(g.x,f,p+c),0===c&&(c=D.node().getBBox().height,t.Rm.info("Title height",c,p)),E.push(D)}let v=c*o.length;if(o.length>1){const n=(o.length-1)*c*.5;E.forEach((D,g)=>D.attr("y",p+g*c-n)),v=c*o.length}const R=s.node().getBBox();s.insert("rect",":first-child").attr("class","box").attr("x",f-B/2-(0,t.D7)().state.padding/2).attr("y",p-v/2-(0,t.D7)().state.padding/2-3.5).attr("width",B+(0,t.D7)().state.padding).attr("height",v+(0,t.D7)().state.padding),t.Rm.info(R)}O++},"drawEdge"),T={},X=(0,t.K2)(function(){},"setConf"),J=(0,t.K2)(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),V=(0,t.K2)(function(e,i,d,h){_=(0,t.D7)().state;const r=(0,t.D7)().securityLevel;let l;"sandbox"===r&&(l=(0,P.Ltv)("#i"+i));const x=(0,P.Ltv)("sandbox"===r?l.nodes()[0].contentDocument.body:"body"),a="sandbox"===r?l.nodes()[0].contentDocument:document;t.Rm.debug("Rendering diagram "+e);const s=x.select(`[id='${i}']`);J(s);const f=h.db.getRootDoc();b(f,s,void 0,!1,x,a,h);const p=_.padding,o=s.node().getBBox(),c=o.width+2*p,E=o.height+2*p;(0,t.a$)(s,E,1.75*c,_.useMaxWidth),s.attr("viewBox",`${o.x-_.padding}  ${o.y-_.padding} `+c+" "+E)},"draw"),Z=(0,t.K2)(e=>e?e.length*_.fontSizeFactor:1,"getLabelWidth"),b=(0,t.K2)((e,i,d,h,r,l,x)=>{const a=new W.T({compound:!0,multigraph:!0});let s,f=!0;for(s=0;s<e.length;s++)if("relation"===e[s].stmt){f=!1;break}a.setGraph(d?{rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:f?1:_.edgeLengthFactor,nodeSep:f?1:50,isMultiGraph:!0}:{rankdir:"TB",multigraph:!0,compound:!0,ranksep:f?1:_.edgeLengthFactor,nodeSep:f?1:50,ranker:"tight-tree",isMultiGraph:!0}),a.setDefaultEdgeLabel(function(){return{}});const p=x.db.getStates(),o=x.db.getRelations(),c=Object.keys(p);for(const n of c){const D=p[n];let g;if(d&&(D.parentId=d),D.doc){let y=i.append("g").attr("id",D.id).attr("class","stateGroup");g=b(D.doc,y,D.id,!h,r,l,x);{y=I(y,D,h);let m=y.node().getBBox();g.width=m.width,g.height=m.height+_.padding/2,T[D.id]={y:_.compositTitleSize}}}else g=L(i,D,a);if(D.note){const m=L(i,{descriptions:[],id:D.id+"-note",note:D.note,type:"note"},a);"left of"===D.note.position?(a.setNode(g.id+"-note",m),a.setNode(g.id,g)):(a.setNode(g.id,g),a.setNode(g.id+"-note",m)),a.setParent(g.id,g.id+"-group"),a.setParent(g.id+"-note",g.id+"-group")}else a.setNode(g.id,g)}t.Rm.debug("Count=",a.nodeCount(),a);let B=0;o.forEach(function(n){B++,t.Rm.debug("Setting edge",n),a.setEdge(n.id1,n.id2,{relation:n,width:Z(n.title),height:_.labelHeight*t.Y2.getRows(n.title).length,labelpos:"c"},"id"+B)}),(0,N.Zp)(a),t.Rm.debug("Graph after layout",a.nodes());const M=i.node();a.nodes().forEach(function(n){void 0!==n&&void 0!==a.node(n)?(t.Rm.warn("Node "+n+": "+JSON.stringify(a.node(n))),r.select("#"+M.id+" #"+n).attr("transform","translate("+(a.node(n).x-a.node(n).width/2)+","+(a.node(n).y+(T[n]?T[n].y:0)-a.node(n).height/2)+" )"),r.select("#"+M.id+" #"+n).attr("data-x-shift",a.node(n).x-a.node(n).width/2),l.querySelectorAll("#"+M.id+" #"+n+" .divider").forEach(g=>{const y=g.parentElement;let m=0,S=0;y&&(y.parentElement&&(m=y.parentElement.getBBox().width),S=parseInt(y.getAttribute("data-x-shift"),10),Number.isNaN(S)&&(S=0)),g.setAttribute("x1",0-S+8),g.setAttribute("x2",m-S-8)})):t.Rm.debug("No Node "+n+": "+JSON.stringify(a.node(n)))});let v=M.getBBox();a.edges().forEach(function(n){void 0!==n&&void 0!==a.edge(n)&&(t.Rm.debug("Edge "+n.v+" -> "+n.w+": "+JSON.stringify(a.edge(n))),Y(i,a.edge(n),a.edge(n).relation))}),v=M.getBBox();const R={id:d||"root",label:d||"root",width:0,height:0};return R.width=v.width+2*_.padding,R.height=v.height+2*_.padding,t.Rm.debug("Doc rendered",R,a),R},"renderDoc"),$={setConf:X,draw:V},Q={parser:w.Zk,get db(){return new w.u4(1)},renderer:$,styles:w.tM,init:(0,t.K2)(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},"init")}}}]);
//# sourceMappingURL=635.e62f823972e9355f.js.map