"use strict";(self.webpackChunkgloomhavensecretariat=self.webpackChunkgloomhavensecretariat||[]).push([[192],{3192:(tt,O,f)=>{f.r(O),f.d(O,{diagram:()=>q});var E,v=f(3102),N=(f(5675),f(8086),f(2271),f(8954),f(6384),f(7452),f(2239),f(9753),f(4082),f(2052)),t=f(2155),o=f(2303),S=f(3172),k=f(8512),C=f(1823),W=(0,o.K2)(e=>e.append("circle").attr("class","start-state").attr("r",(0,t.D7)().state.sizeUnit).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit),"drawStartState"),U=(0,o.K2)(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",(0,t.D7)().state.textHeight).attr("class","divider").attr("x2",2*(0,t.D7)().state.textHeight).attr("y1",0).attr("y2",0),"drawDivider"),H=(0,o.K2)((e,i)=>{const d=e.append("text").attr("x",2*(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.textHeight+2*(0,t.D7)().state.padding).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.id),c=d.node().getBBox();return e.insert("rect",":first-child").attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding).attr("width",c.width+2*(0,t.D7)().state.padding).attr("height",c.height+2*(0,t.D7)().state.padding).attr("rx",(0,t.D7)().state.radius),d},"drawSimpleState"),I=(0,o.K2)((e,i)=>{const d=(0,o.K2)(function(g,B,y){const w=g.append("tspan").attr("x",2*(0,t.D7)().state.padding).text(B);y||w.attr("dy",(0,t.D7)().state.textHeight)},"addTspan"),r=e.append("text").attr("x",2*(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.textHeight+1.3*(0,t.D7)().state.padding).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.descriptions[0]).node().getBBox(),p=r.height,D=e.append("text").attr("x",(0,t.D7)().state.padding).attr("y",p+.4*(0,t.D7)().state.padding+(0,t.D7)().state.dividerMargin+(0,t.D7)().state.textHeight).attr("class","state-description");let a=!0,s=!0;i.descriptions.forEach(function(g){a||(d(D,g,s),s=!1),a=!1});const _=e.append("line").attr("x1",(0,t.D7)().state.padding).attr("y1",(0,t.D7)().state.padding+p+(0,t.D7)().state.dividerMargin/2).attr("y2",(0,t.D7)().state.padding+p+(0,t.D7)().state.dividerMargin/2).attr("class","descr-divider"),x=D.node().getBBox(),h=Math.max(x.width,r.width);return _.attr("x2",h+3*(0,t.D7)().state.padding),e.insert("rect",":first-child").attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding).attr("width",h+2*(0,t.D7)().state.padding).attr("height",x.height+p+2*(0,t.D7)().state.padding).attr("rx",(0,t.D7)().state.radius),e},"drawDescrState"),z=(0,o.K2)((e,i,d)=>{const c=(0,t.D7)().state.padding,r=2*(0,t.D7)().state.padding,p=e.node().getBBox(),D=p.width,a=p.x,s=e.append("text").attr("x",0).attr("y",(0,t.D7)().state.titleShift).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.id),x=s.node().getBBox().width+r;let g,h=Math.max(x,D);h===D&&(h+=r);const B=e.node().getBBox();g=a-c,x>D&&(g=(D-h)/2+c),Math.abs(a-B.x)<c&&x>D&&(g=a-(x-D)/2);const y=1-(0,t.D7)().state.textHeight;return e.insert("rect",":first-child").attr("x",g).attr("y",y).attr("class",d?"alt-composit":"composit").attr("width",h).attr("height",B.height+(0,t.D7)().state.textHeight+(0,t.D7)().state.titleShift+1).attr("rx","0"),s.attr("x",g+c),x<=D&&s.attr("x",a+(h-r)/2-x/2+c),e.insert("rect",":first-child").attr("x",g).attr("y",(0,t.D7)().state.titleShift-(0,t.D7)().state.textHeight-(0,t.D7)().state.padding).attr("width",h).attr("height",3*(0,t.D7)().state.textHeight).attr("rx",(0,t.D7)().state.radius),e.insert("rect",":first-child").attr("x",g).attr("y",(0,t.D7)().state.titleShift-(0,t.D7)().state.textHeight-(0,t.D7)().state.padding).attr("width",h).attr("height",B.height+3+2*(0,t.D7)().state.textHeight).attr("rx",(0,t.D7)().state.radius),e},"addTitleAndBox"),j=(0,o.K2)(e=>(e.append("circle").attr("class","end-state-outer").attr("r",(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",(0,t.D7)().state.sizeUnit).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+2).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+2)),"drawEndState"),Y=(0,o.K2)((e,i)=>{let d=(0,t.D7)().state.forkWidth,c=(0,t.D7)().state.forkHeight;if(i.parentId){let r=d;d=c,c=r}return e.append("rect").style("stroke","black").style("fill","black").attr("width",d).attr("height",c).attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding)},"drawForkJoinState"),G=(0,o.K2)((e,i,d,c)=>{let r=0;const p=c.append("text");p.style("text-anchor","start"),p.attr("class","noteText");let D=e.replace(/\r\n/g,"<br/>");D=D.replace(/\n/g,"<br/>");const a=D.split(t.Y2.lineBreakRegex);let s=1.25*(0,t.D7)().state.noteMargin;for(const _ of a){const x=_.trim();if(x.length>0){const h=p.append("tspan");h.text(x),0===s&&(s+=h.node().getBBox().height),r+=s,h.attr("x",i+(0,t.D7)().state.noteMargin),h.attr("y",d+r+1.25*(0,t.D7)().state.noteMargin)}}return{textWidth:p.node().getBBox().width,textHeight:r}},"_drawLongText"),J=(0,o.K2)((e,i)=>{i.attr("class","state-note");const d=i.append("rect").attr("x",0).attr("y",(0,t.D7)().state.padding),c=i.append("g"),{textWidth:r,textHeight:p}=G(e,0,0,c);return d.attr("height",p+2*(0,t.D7)().state.noteMargin),d.attr("width",r+2*(0,t.D7)().state.noteMargin),d},"drawNote"),K=(0,o.K2)(function(e,i){const d=i.id,c={id:d,label:i.id,width:0,height:0},r=e.append("g").attr("id",d).attr("class","stateGroup");"start"===i.type&&W(r),"end"===i.type&&j(r),("fork"===i.type||"join"===i.type)&&Y(r,i),"note"===i.type&&J(i.note.text,r),"divider"===i.type&&U(r),"default"===i.type&&0===i.descriptions.length&&H(r,i),"default"===i.type&&i.descriptions.length>0&&I(r,i);const p=r.node().getBBox();return c.width=p.width+2*(0,t.D7)().state.padding,c.height=p.height+2*(0,t.D7)().state.padding,c},"drawState"),b=0,F=(0,o.K2)(function(e,i,d){const c=(0,o.K2)(function(s){switch(s){case v.u4.relationType.AGGREGATION:return"aggregation";case v.u4.relationType.EXTENSION:return"extension";case v.u4.relationType.COMPOSITION:return"composition";case v.u4.relationType.DEPENDENCY:return"dependency"}},"getRelationType");i.points=i.points.filter(s=>!Number.isNaN(s.y));const r=i.points,p=(0,S.n8j)().x(function(s){return s.x}).y(function(s){return s.y}).curve(S.qrM),D=e.append("path").attr("d",p(r)).attr("id","edge"+b).attr("class","transition");let a="";if((0,t.D7)().state.arrowMarkerAbsolute&&(a=(0,t.ID)(!0)),D.attr("marker-end","url("+a+"#"+c(v.u4.relationType.DEPENDENCY)+"End)"),void 0!==d.title){const s=e.append("g").attr("class","stateLabel"),{x:_,y:x}=N._K.calcLabelPosition(i.points),h=t.Y2.getRows(d.title);let g=0;const B=[];let y=0,w=0;for(let n=0;n<=h.length;n++){const u=s.append("text").attr("text-anchor","middle").text(h[n]).attr("x",_).attr("y",x+g),l=u.node().getBBox();y=Math.max(y,l.width),w=Math.min(w,l.x),o.Rm.info(l.x,_,x+g),0===g&&(g=u.node().getBBox().height,o.Rm.info("Title height",g,x)),B.push(u)}let P=g*h.length;if(h.length>1){const n=(h.length-1)*g*.5;B.forEach((u,l)=>u.attr("y",x+l*g-n)),P=g*h.length}const R=s.node().getBBox();s.insert("rect",":first-child").attr("class","box").attr("x",_-y/2-(0,t.D7)().state.padding/2).attr("y",x-P/2-(0,t.D7)().state.padding/2-3.5).attr("width",y+(0,t.D7)().state.padding).attr("height",P+(0,t.D7)().state.padding),o.Rm.info(R)}b++},"drawEdge"),L={},X=(0,o.K2)(function(){},"setConf"),Z=(0,o.K2)(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),$=(0,o.K2)(function(e,i,d,c){E=(0,t.D7)().state;const r=(0,t.D7)().securityLevel;let p;"sandbox"===r&&(p=(0,S.Ltv)("#i"+i));const D=(0,S.Ltv)("sandbox"===r?p.nodes()[0].contentDocument.body:"body"),a="sandbox"===r?p.nodes()[0].contentDocument:document;o.Rm.debug("Rendering diagram "+e);const s=D.select(`[id='${i}']`);Z(s);const _=c.db.getRootDoc();A(_,s,void 0,!1,D,a,c);const x=E.padding,h=s.node().getBBox(),g=h.width+2*x,B=h.height+2*x;(0,t.a$)(s,B,1.75*g,E.useMaxWidth),s.attr("viewBox",`${h.x-E.padding}  ${h.y-E.padding} `+g+" "+B)},"draw"),Q=(0,o.K2)(e=>e?e.length*E.fontSizeFactor:1,"getLabelWidth"),A=(0,o.K2)((e,i,d,c,r,p,D)=>{const a=new C.T({compound:!0,multigraph:!0});let s,_=!0;for(s=0;s<e.length;s++)if("relation"===e[s].stmt){_=!1;break}a.setGraph(d?{rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:_?1:E.edgeLengthFactor,nodeSep:_?1:50,isMultiGraph:!0}:{rankdir:"TB",multigraph:!0,compound:!0,ranksep:_?1:E.edgeLengthFactor,nodeSep:_?1:50,ranker:"tight-tree",isMultiGraph:!0}),a.setDefaultEdgeLabel(function(){return{}});const x=D.db.getStates(),h=D.db.getRelations(),g=Object.keys(x);for(const n of g){const u=x[n];let l;if(d&&(u.parentId=d),u.doc){let m=i.append("g").attr("id",u.id).attr("class","stateGroup");l=A(u.doc,m,u.id,!c,r,p,D);{m=z(m,u,c);let M=m.node().getBBox();l.width=M.width,l.height=M.height+E.padding/2,L[u.id]={y:E.compositTitleSize}}}else l=K(i,u,a);if(u.note){const M=K(i,{descriptions:[],id:u.id+"-note",note:u.note,type:"note"},a);"left of"===u.note.position?(a.setNode(l.id+"-note",M),a.setNode(l.id,l)):(a.setNode(l.id,l),a.setNode(l.id+"-note",M)),a.setParent(l.id,l.id+"-group"),a.setParent(l.id+"-note",l.id+"-group")}else a.setNode(l.id,l)}o.Rm.debug("Count=",a.nodeCount(),a);let y=0;h.forEach(function(n){y++,o.Rm.debug("Setting edge",n),a.setEdge(n.id1,n.id2,{relation:n,width:Q(n.title),height:E.labelHeight*t.Y2.getRows(n.title).length,labelpos:"c"},"id"+y)}),(0,k.Zp)(a),o.Rm.debug("Graph after layout",a.nodes());const w=i.node();a.nodes().forEach(function(n){void 0!==n&&void 0!==a.node(n)?(o.Rm.warn("Node "+n+": "+JSON.stringify(a.node(n))),r.select("#"+w.id+" #"+n).attr("transform","translate("+(a.node(n).x-a.node(n).width/2)+","+(a.node(n).y+(L[n]?L[n].y:0)-a.node(n).height/2)+" )"),r.select("#"+w.id+" #"+n).attr("data-x-shift",a.node(n).x-a.node(n).width/2),p.querySelectorAll("#"+w.id+" #"+n+" .divider").forEach(l=>{const m=l.parentElement;let M=0,T=0;m&&(m.parentElement&&(M=m.parentElement.getBBox().width),T=parseInt(m.getAttribute("data-x-shift"),10),Number.isNaN(T)&&(T=0)),l.setAttribute("x1",0-T+8),l.setAttribute("x2",M-T-8)})):o.Rm.debug("No Node "+n+": "+JSON.stringify(a.node(n)))});let P=w.getBBox();a.edges().forEach(function(n){void 0!==n&&void 0!==a.edge(n)&&(o.Rm.debug("Edge "+n.v+" -> "+n.w+": "+JSON.stringify(a.edge(n))),F(i,a.edge(n),a.edge(n).relation))}),P=w.getBBox();const R={id:d||"root",label:d||"root",width:0,height:0};return R.width=P.width+2*E.padding,R.height=P.height+2*E.padding,o.Rm.debug("Doc rendered",R,a),R},"renderDoc"),V={setConf:X,draw:$},q={parser:v.Zk,get db(){return new v.u4(1)},renderer:V,styles:v.tM,init:(0,o.K2)(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},"init")}}}]);
//# sourceMappingURL=192.d293dfa912e8d0a1.js.map